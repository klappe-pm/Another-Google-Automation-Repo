#!/usr/bin/env bash
set -euo pipefail

# Pre-commit Hook
# Runs automated checks and fixes on staged files

# Get the repository root
REPO_ROOT=$(git rev-parse --show-toplevel)

echo "Running pre-commit checks..."

# Check if Node.js is available
if ! command -v node &> /dev/null; then
  echo "Error: Node.js is required but not installed"
  exit 1
fi

# Run the consolidated pre-commit checker
if node "$REPO_ROOT/automation/precommit/check-all.js"; then
  echo "All pre-commit checks passed!"
  exit 0
else
  echo "Pre-commit checks failed"
  echo "Run 'npm run fix' to automatically fix issues"
  exit 1
fi